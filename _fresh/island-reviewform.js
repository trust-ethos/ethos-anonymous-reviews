import{a as L}from"./chunk-ULBJE5V7.js";import{a as R,c as u}from"./chunk-BFVMAUAC.js";import"./chunk-GI7LLYGM.js";import{a as e}from"./chunk-BYRZ2NRM.js";import"./chunk-JP5XG2OT.js";function q(){let r=u(null),n=u(""),o=u(""),s=u(""),f=u(!1),t=u(null),C=u(!0),g=u(0),a=u(null);R(()=>{let l=async()=>{try{let i=await fetch("/api/auth/reputation");if(i.ok){let m=await i.json();t.value=m}else t.value={authenticated:!1}}catch(i){console.log("Failed to check reputation:",i),t.value={authenticated:!1}}finally{C.value=!1}},v=async()=>{try{let i=await fetch("/api/kairos-stats");if(i.ok){let m=await i.json();g.value=m.score||0}}catch(i){console.log("Failed to fetch KairosAgent score:",i)}};l(),v()},[]);let w=()=>!t.value?.authenticated||!t.value?.user||!r.value?!1:t.value.user.username.toLowerCase()===r.value.username.toLowerCase(),H=async l=>{if(l.preventDefault(),!r.value){alert("Please search for and select a profile to review.");return}if(!n.value.trim()){alert("Please enter a review title.");return}if(!o.value.trim()){alert("Please enter a review description.");return}if(!s.value){alert("Please select a review type (Negative, Neutral, or Positive).");return}if(w()){alert("You cannot leave a review for yourself.");return}f.value=!0;try{console.log("Getting CSRF token...");let v=await fetch("/api/auth/csrf");if(!v.ok)throw new Error("Failed to get CSRF token");let m=(await v.json()).csrfToken;if(s.value==="slash"){console.log("Submitting slash request:",{profile:r.value,title:n.value,description:o.value,sentiment:s.value});let S=await fetch("/api/slash/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:r.value.profileId,profileUsername:r.value.username,title:n.value,description:o.value,csrfToken:m,requestNonce:crypto.randomUUID(),reviewerReputationLevel:t.value?.reputation?.level||"reputable"})}),p=await S.json();S.ok?(console.log("\u2705 Slash request submitted:",p),a.value={message:"Slash request submitted successfully! We will review and process your request manually.",profileUsername:r.value.username},r.value=null,n.value="",o.value="",s.value=""):(console.error("\u274C Slash request failed:",p),alert(`Failed to submit slash request: ${p.error||"Unknown error"}`));return}console.log("Submitting review to blockchain (this may take 30-60 seconds):",{profile:r.value,title:n.value,description:o.value,sentiment:s.value});let k=await fetch("/api/reviews/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:r.value.profileId,profileUsername:r.value.username,title:n.value,description:o.value,sentiment:s.value,csrfToken:m,requestNonce:crypto.randomUUID(),reviewerReputationLevel:t.value?.reputation?.level||"reputable"})}),d=await k.json();k.ok?(console.log("\u2705 Review confirmed on blockchain:",d),a.value={transactionHash:d.transactionHash,reviewId:d.reviewId,profileUsername:r.value.username,message:d.message,links:d.links},r.value=null,n.value="",o.value="",s.value=""):(console.error("\u274C Review submission failed:",d),alert(`Failed to submit review: ${d.error||"Unknown error"}`))}catch(v){console.error("\u274C Review submission error:",v),alert(`Error submitting review: ${v instanceof Error?v.message:"Unknown error"}`)}finally{f.value=!1}},x=n.value.length,h=120,b=t.value?.reputation?.canSubmit??!1,y=t.value?.reputation?.reason||t.value?.reason,c=w();return e("form",{onSubmit:H,class:"space-y-6",children:[a.value&&e("div",{class:`rounded-lg p-6 ${a.value.message?.includes("Slash request")?"bg-red-900/20 border border-red-700/50":"bg-green-900/20 border border-green-700/50"}`,children:e("div",{class:"flex items-start gap-3",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:`w-6 h-6 ${a.value.message?.includes("Slash request")?"text-red-400":"text-green-400"}`,fill:"currentColor",viewBox:"0 0 24 24",children:e("path",{d:a.value.message?.includes("Slash request")?"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z":"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})}),e("div",{class:"flex-1",children:[e("h3",{class:`text-lg font-semibold mb-2 ${a.value.message?.includes("Slash request")?"text-red-300":"text-green-300"}`,children:a.value.message?.includes("Slash request")?"Slash Request Submitted!":"Review Confirmed on Blockchain!"}),e("p",{class:`mb-4 ${a.value.message?.includes("Slash request")?"text-red-200":"text-green-200"}`,children:a.value.message||"Review submitted and confirmed!"}),!a.value.message?.includes("Slash request")&&(a.value.reviewId||a.value.links?.ethosReview)&&e("div",{class:"mb-4",children:e("a",{href:a.value.links?.ethosReview||`https://app.ethos.network/activity/review/${a.value.reviewId}`,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center gap-2 text-green-300 hover:text-green-200 font-medium text-base underline",children:["View Your Review on Ethos",e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e("path",{d:"M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"})})]})}),e("div",{class:"space-y-3",children:!a.value.message?.includes("Slash request")&&a.value.transactionHash&&e("div",{children:[e("div",{class:"text-sm font-medium text-green-300 mb-1",children:"Transaction Hash:"}),e("div",{class:"font-mono text-xs text-green-200 bg-green-900/30 p-2 rounded border break-all",children:a.value.transactionHash}),e("a",{href:a.value.links?.basescan||`https://basescan.org/tx/${a.value.transactionHash}`,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center gap-1 text-sm text-green-400 hover:text-green-300 mt-1",children:["View on BaseScan",e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:e("path",{d:"M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"})})]})]})}),e("button",{type:"button",onClick:()=>{a.value=null,r.value=null,n.value="",o.value="",s.value=""},class:"mt-4 text-sm text-green-400 hover:text-green-300 underline",children:"Submit Another Review"})]})]})}),t.value?.authenticated&&b&&e("div",{children:[e("label",{class:"block text-sm font-medium mb-2",children:"You"}),e("div",{class:`flex items-center gap-3 p-3 border border-neutral-700 rounded-md ${t.value.reputation?.level==="exemplary"?"bg-green-900/20 border-green-700/50":t.value.reputation?.level==="reputable"?"bg-blue-900/20 border-blue-700/50":"bg-neutral-800"}`,children:[e("div",{class:`w-10 h-10 rounded-full flex items-center justify-center text-neutral-300 ${t.value.reputation?.level==="exemplary"?"bg-green-800":t.value.reputation?.level==="reputable"?"bg-blue-800":"bg-neutral-600"}`,children:e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e("div",{class:"flex-1",children:[e("div",{class:"text-sm font-medium",children:"Anonymous Reputable+ user"}),e("div",{class:"text-xs text-neutral-400",children:t.value.reputation?"Reputation verified":"Reputation unknown"})]})]}),e("div",{class:"text-xs text-neutral-400 mt-2",children:'Your review will be saved anonymously. You will appear as a "Reputable+" user to protect your identity.'})]}),e("div",{children:[e("label",{class:"block text-sm font-medium mb-2",children:"Search X account or ENS"}),e(L,{selectedProfile:r,onProfileSelect:l=>r.value=l}),c&&e("div",{class:"mt-2 p-3 bg-yellow-900/20 border border-yellow-700/50 rounded-md",children:e("div",{class:"flex items-center gap-2",children:[e("svg",{class:"w-4 h-4 text-yellow-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:e("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})}),e("div",{class:"text-sm text-yellow-300",children:["You cannot leave a review for yourself (@",r.value?.username,")."]})]})})]}),e("div",{children:[e("label",{class:"block text-sm font-medium mb-2",children:"Review type"}),e("div",{class:"flex gap-2",children:[{value:"negative",label:"Negative",color:"text-red-400 border-red-400",disabled:!1},{value:"neutral",label:"Neutral",color:"text-yellow-400 border-yellow-400",disabled:!1},{value:"positive",label:"Positive",color:"text-green-400 border-green-400",disabled:!1},...g.value>=1400?[{value:"slash",label:"Slash",color:"text-red-400 border-red-400",disabled:!1}]:[]].map(l=>e("div",{class:"relative",children:[e("button",{type:"button",onClick:()=>!l.disabled&&(s.value=l.value),disabled:l.disabled,class:`px-4 py-2 border rounded-md text-sm font-medium transition-colors ${l.disabled?"border-neutral-700 text-neutral-500 cursor-not-allowed opacity-50":s.value===l.value?`${l.color} bg-opacity-10`:"border-neutral-700 text-neutral-400 hover:border-neutral-600"}`,title:l.disabled?"Coming soon":void 0,children:l.label}),l.disabled&&e("div",{class:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-neutral-800 text-neutral-200 text-xs px-2 py-1 rounded shadow-lg opacity-0 hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:"Coming soon"})]},l.value))})]}),s.value==="slash"&&e("div",{class:"bg-red-900/20 border border-red-700/50 rounded-lg p-4 mb-6",children:e("div",{class:"flex items-start gap-3",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"w-5 h-5 text-red-400 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),e("div",{children:[e("h4",{class:"text-sm font-medium text-red-300 mb-2",children:"Slash Request Information"}),e("p",{class:"text-sm text-red-200 leading-relaxed",children:"Slashes are proposed and then handled manually. We will process your slash once we are capable of doing so. The Ethos team reserves the right to refrain from following through with the slash if they feel it violates the purpose of this app or the Ethos T&Cs. All slashes are for 50 credibility score."})]})]})}),e("div",{children:[e("label",{class:"block text-sm font-medium mb-2",children:s.value==="slash"?"Slash title":"Review title"}),e("input",{type:"text",value:n.value,onInput:l=>n.value=l.target.value,maxLength:h,placeholder:"Brief summary of your review...",class:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-md text-sm placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-500 focus:border-transparent",required:!0}),e("div",{class:"flex justify-end items-center mt-1",children:e("div",{class:`text-xs ${x>h*.9?"text-yellow-400":"text-neutral-500"}`,children:[x,"/",h]})})]}),e("div",{children:[e("label",{class:"block text-sm font-medium mb-2",children:s.value==="slash"?"Slash description":"Review description"}),e("textarea",{value:o.value,onInput:l=>o.value=l.target.value,placeholder:"Share your detailed experience and feedback...",rows:4,class:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-md text-sm placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-500 focus:border-transparent resize-vertical",required:!0}),e("div",{class:"text-xs text-neutral-500 mt-1",children:["Please be thoughtful about what you write. Including evidence is always wise, especially when anonymous. Messages of hate or violence may be removed from the Ethos.network website per our ",e("a",{href:"https://ethos.network/terms",target:"_blank",rel:"noopener noreferrer",class:"text-neutral-400 hover:text-neutral-300 underline",children:"Terms of Service"}),"."]})]}),e("button",{type:"submit",disabled:f.value||!r.value||!n.value.trim()||!o.value.trim()||!s.value||t.value?.authenticated&&!b||!t.value?.authenticated||c,class:`w-full px-4 py-2 rounded-md font-medium transition-colors ${c?"bg-yellow-900 text-yellow-300 cursor-not-allowed":t.value?.authenticated&&!b?"bg-red-900 text-red-300 cursor-not-allowed":t.value?.authenticated?"bg-neutral-50 text-neutral-950 hover:bg-neutral-200 disabled:opacity-50 disabled:cursor-not-allowed":"bg-neutral-700 text-neutral-400 cursor-not-allowed"}`,children:f.value?s.value==="slash"?"Submitting slash request...":"Confirming on blockchain...":c?"Cannot review yourself":t.value?.authenticated?t.value?.authenticated&&!b?"Must be reputable to submit":s.value==="slash"?"Request slash":"Submit anon review":"Please login"}),c&&e("div",{class:"text-xs text-yellow-400 text-center",children:"You cannot leave a review for your own profile."}),t.value?.authenticated&&!b&&!c&&y&&e("div",{class:"text-xs text-red-400 text-center",children:y}),!t.value?.authenticated&&e("div",{class:"text-xs text-neutral-500 text-center",children:"Connect with X to submit reviews. Must be reputable on Ethos to submit."})]})}export{q as default};
